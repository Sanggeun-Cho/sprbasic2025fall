<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Writing Create</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>
<body>
Detail!!

<div>
    id : <input type="text" id="input_id"/> <br/>
  title : <input type="text" id="input_title"/> <br/>
  content : <input type="text" id="input_content"/> <br/>
</div>

<button onclick="update_writing()">수정하기</button>
<button onclick="delete_writing()">삭제하기</button>

<!--<button onclick="detail_writing()">등록하기</button>-->
<script>
    let tempHref = location.href; // 현재 주소값
    alert(tempHref);

    let tempOrder = tempHref.lastIndexOf("/");
    let tempId = tempHref.substring(tempOrder + 1);
    alert(tempId);

    let tempOrder2 = tempId.indexOf("?");
    if(tempOrder2 > -1) {
        tempId = tempId.substring(0, tempOrder2);
    }
    alert(tempId);

    // let tempArray = tempHref.split("/");
    // let tempId2 = tempArray[tempArray.length - 1];
    // alert(tempId);

    $(function(){
        // 페이지 뜨자마자 실행
        detail_writing();
    })

  function detail_writing(){
    // alert("등록이 시작됩니다!");

    $.ajax({
      url: '/api/writing',
      method: 'GET',
      data : {
        id : tempId
      },
      // dataType : "json",
      // contentType:"application/json",
      success: function (data, status, xhr) {
        alert("data : : " + JSON.stringify(data));

        let writing = data["data"];
        let id = writing["id"];
        let title = writing["title"];
        let content = writing["content"];

        $("#input_id").val(id);
          $("#input_title").val(title);
          $("#input_content").val(content);
      },
      error: function (data, status, err) {
          alert("error :" + JSON.stringify(data));
      },
      complete: function () {
      }
    });
  }
    function update_writing(){
        // alert("등록이 시작됩니다!");

        $.ajax({
            url: '/api/writing',
            method: 'PUT',
            data : JSON.stringify({
                id : $("#input_id").val()
                ,title: $("#input_title").val() // value를 찾아달라
                , content: $("#input_content").val()
            }),
            contentType:"application/json",
            success: function (data, status, xhr) {
            },
            error: function (data, status, err) {
                alert("error :" + JSON.stringify(data));
            },
            complete: function () {
            }
        });
    }
    function delete_writing(){
        // alert("등록이 시작됩니다!");

        $.ajax({
            url: '/api/writing',
            method: 'DELETE',
            data : JSON.stringify({
                id : $("#input_id").val()
            }),
            contentType:"application/json",
            success: function (data, status, xhr) {
            },
            error: function (data, status, err) {
                alert("error :" + JSON.stringify(data));
            },
            complete: function () {
            }
        });
    }
</script>

</body>
</html>